rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // check if an auth user is admin
    function isAdmin(uid) {
      let role = get(/databases/$(database)/documents/users/$(uid)).data.role;
      return role == "admin";
    }
    // check if an auth user is producer 
    function isProducer(uid) {
      let role = get(/databases/$(database)/documents/users/$(uid)).data.role;
      return role == "producer";
    }
    // check if an auth user is evaluator 
    function isEvaluator(uid) {
      let role = get(/databases/$(database)/documents/users/$(uid)).data.role;
      return role == "evaluator";
    }
    // RULES FOR "USER" DOCUMENTS
    // ==========================
    match /users/{userId} {
    	// admin can read any user's info, other roles can only read their own
      allow read: if request.auth != null && (isAdmin(request.auth.uid) || request.auth.uid == userId)
      // XXX
      // no delete for now
      allow delete: if false
      // XXX
      // need to flesh out rules that only allow creation of specific fields
      allow create: if request.auth != null
    }
  }
}
